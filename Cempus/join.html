<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>

    <p>회원가입</p>
    <div class="input-txt">
        <input type="hidden" name="dupChk" value="0">
        <input type="text" name="id" placeholder="아이디">
        <button type="button" onclick="checkId()">중복확인</button>
        <p class="success-msg"></p>
        <p class="alert-msg" id="alert-id" style="display:none;"></p>
    </div>
    <div class="input-txt">
        <input type="password" name="pw" placeholder="비밀번호">
        <p class="alert-msg" id="alert-pw" style="display:none;"></p>
    </div>

    <div class="btn-submit">
        <button type="button" onclick="join()">회원가입</button>
    </div>
</body>
<script>
    function checkId() {
        var id = $('input[name=id]').val();
        $.ajax({
            url: './php/user/checkId.php',
            type: 'POST',
            data: {id: id},
            dataType: 'json',
            success: function (data) {
                if (data.result == 200) {
                    $('#alert-id').hide();
                    $('.success-msg').text(data.message);
                    $('.success-msg').show();
                    $('input[name=dupChk]').val(1);
                } else {
                    $('.success-msg').hide();
                    $('#alert-id').text(data.message);
                    $('#alert-id').show();
                    $('input[name=dupChk]').val(0);
                }
            }
        });
    }

    function join() {
        var id = $('input[name=id]').val();
        var pw = $('input[name=pw]').val();
        var dupChk = $('input[name=dupChk]').val();
        if (id == '') {
            $('#alert-id').text('아이디를 입력해주세요.');
            $('#alert-id').show();
            $('input[name=id]').focus();
            return false;
        } else {
            $('#alert-id').hide();
        }

        if (dupChk == 0) {
            $('#alert-id').text('아이디 중복확인을 해주세요.');
            $('#alert-id').show();
            $('input[name=id]').focus();
            return false;
        } else {
            $('#alert-id').hide();
        }

        if (pw == '') {
            $('#alert-pw').text('비밀번호를 입력해주세요.');
            $('#alert-pw').show();
            $('input[name=pw]').focus();
            return false;
        } else {
            $('#alert-pw').hide();
        }

        $.ajax({
            url: './php/user/join.php',
            type: 'POST',
            data: {id: id, pw: pw},
            dataType: 'json',
            success: function (data) {
                if (data.result == 200) {
                    alert(data.message);
                    location.href = 'login.html';
                } else {
                    alert(data.message);
                }
            }
        });
    }
</script>
</html>